# FaultMaven API Gateway Configuration
# This file configures the pluggable authentication system

# ============================================================================
# Authentication Provider
# ============================================================================

auth:
  # Provider type: fm-auth-service (self-hosted) or supabase (enterprise)
  provider: fm-auth-service

  config:
    # Service URL for fm-auth-service
    service_url: http://auth-service:8001

    # JWT configuration
    jwt_issuer: faultmaven-self-hosted
    jwt_audience: faultmaven-api

    # Token validation settings
    validate_expiry: true
    require_https: false  # Set to true in production with reverse proxy

# ============================================================================
# Rate Limiting (Optional)
# ============================================================================

rate_limiting:
  enabled: true

  # Requests per minute per IP
  default_limit: 100

  # Endpoint-specific limits
  endpoints:
    /v1/auth/login: 10
    /v1/auth/register: 5
    /v1/knowledge/upload: 20

# ============================================================================
# CORS Configuration
# ============================================================================

cors:
  # Allowed origins (can be overridden by CORS_ORIGINS env var)
  allowed_origins:
    - http://localhost:3000
    - http://localhost:8000

  # Allowed methods
  allowed_methods:
    - GET
    - POST
    - PUT
    - DELETE
    - OPTIONS

  # Allowed headers
  allowed_headers:
    - Authorization
    - Content-Type
    - X-Request-ID

  # Allow credentials (cookies, auth headers)
  allow_credentials: true

  # Max age for preflight cache (seconds)
  max_age: 3600

# ============================================================================
# Service Routing
# ============================================================================

routes:
  # Auth service routes
  - path: /v1/auth/*
    service: auth-service
    strip_prefix: false
    timeout: 30

  # Session service routes
  - path: /v1/sessions/*
    service: session-service
    strip_prefix: false
    timeout: 30

  # Case service routes
  - path: /v1/cases/*
    service: case-service
    strip_prefix: false
    timeout: 60

  # Knowledge service routes
  - path: /v1/knowledge/*
    service: knowledge-service
    strip_prefix: false
    timeout: 120  # Longer timeout for RAG operations

  # Evidence service routes
  - path: /v1/evidence/*
    service: evidence-service
    strip_prefix: false
    timeout: 60

# ============================================================================
# Capabilities API Response (Self-Hosted)
# ============================================================================

capabilities:
  deploymentMode: self-hosted
  version: 1.0.0

  features:
    chat: true
    knowledgeBase: true
    cases: true
    organizations: false
    teams: false
    sso: false

  auth:
    type: jwt
    loginUrl: http://localhost:8000/v1/auth/login

  dashboardUrl: http://localhost:3000

# ============================================================================
# Health Check Configuration
# ============================================================================

health:
  # Services to check
  services:
    - auth-service
    - session-service
    - case-service
    - knowledge-service
    - evidence-service

  # Check interval (seconds)
  check_interval: 30

  # Timeout per check (seconds)
  timeout: 5

# ============================================================================
# Logging Configuration
# ============================================================================

logging:
  # Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
  level: INFO

  # Log format: json or text
  format: json

  # Include request details in logs
  include_request_id: true
  include_user_id: true

  # Sensitive fields to redact from logs
  redact_fields:
    - password
    - api_key
    - token
    - secret

# ============================================================================
# NOTES
# ============================================================================
#
# - This is the self-hosted configuration
# - For enterprise deployment, change auth.provider to "supabase"
# - Environment variables take precedence over this file
# - Restart gateway after configuration changes
#
